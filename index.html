
<!DOCTYPE html>
<html>
<head>
<title>Icecrown Realtime Bosses</title>
<meta charset="utf-8">
<link id="fav" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAdCAMAAABhTZc9AAAAPFBMVEUAAAAAAQDv7e6xtLIAAAAAAAD9/fwAAAAZGRkAAADa8O5VVVWlmpnPBwbhrquVLCXSzcrUX1qIeXZISUiUNCNLAAAACnRSTlMB////tSL/jPxEb8QCRAAAARBJREFUeAFt0QeOxSAMBNBvk2oc0+5/1x1WJk0ZVfQ0pv2uzPu67vPvMyt51m/bWoxtA39Y1LwguRJNb4xhGQmvNnCQ8/6oetMTMfy7OvZez2pH5tfweVTDS5Ho5d2rd83h0iYSkEFiZnoem8BaSjFXK0Xa7VSkeiBux1FECTy0ha7FLFlJXbmBz+sKGinVqilBTZgjUce530jAgJAztIiw+qFdxWqSmrJmwwLozzGBcQlBUtKccXrT86XBLVLU/oAtL1m1tQ3omTciYg7+A8wNTX9mf03mutTaas7K7Le5KwYvGW0o5t5DBEX4P4ruPRM0oPutKylXRHs40v7QnShuHvJHfIy+BYNfma9ht6v+AbHID/hC8daLAAAAAElFTkSuQmCC" rel="icon" type="image/png" />
<style>
html {
  background: #16190c;
}
html, body {
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

body {
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  align-content: center;
  justify-items: center;
}

body:after {
  position: fixed;
  top: 0;
  display: block;
  content: ' ';
  width: 100vw;
  height: 100vh;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #16190c;
  filter: blur(calc(min(0.5vw, 1vh)));
  background-image: url(data:image/jpg;base64,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);
  z-index: -1;
}

label, a, .boss { font-family: sans-serif }
label, .boss { font-size: 1.5vw }
.boss {
  position: absolute;
  background-size: 1.5vw;
  background-repeat: no-repeat;
  display: none;
  padding-left: 1.5vw;
  cursor: default;
  flex-direction: column;
}

.current, .next { display: flex }
.next { z-index: 10 }
.boss:hover {
  z-index: 100;
  opacity: 1;
  filter: grayscale(0);
}

.next {
  filter: grayscale(1);
  opacity: 0.5;
}

#map {
  display: block;
  width: 100vw;
  height: 66vw;
  position: relative;
  background-image: url(icecrown.webp), url(icecrown.jpg);
  background-position: center;
  background-size: 100%;
  background-repeat: no-repeat;
}

label, .boss a, .boss time {
  color: white;
  text-shadow:
   -1px -1px 0 #000,  
    1px -1px 0 #000,
    -1px 1px 0 #000,
     1px 1px 0 #000,
     0px 0px 10px #000;
}

.boss time { user-select: none }
.boss time:before { content: ' ' }
.boss:hover i, .boss:hover a, .boss:hover .loot { display: block }
.boss a { display: none }
.boss i {
  font-family: monospace;
  font-size: 1vw;
  display: none;
  position: relative;
  background-color: black;
  color: white;
  padding: 5px;
  top: 5px;
  border-radius: 4px;
  border-radius: 4px;
  margin-bottom: 8px;
  text-align: center;
}

@media (orientation: landscape) and (max-height: 66vw) {
  label, .boss {
    background-size: 2.25vh;
    padding-left: 2.25vh;
    font-size: 2.25vh;
  }
  .boss i {
    font-size: 1.5vh;
  }

  #map {
    width: 151.5151vh;
    height: 100vh;
  }
}

.loot {
  display: none;
  left: 0;
  bottom: 0;
  color: white;
  padding: 5px;
  background: #0007;
  border-radius: 5px;
}

</style>
</head>
<body>
  <div id="map">
    <label><input type="checkbox" id="sound"> sound</label>
    <label><input type="checkbox" id="notify"> notify</label>
    <label><input type="checkbox" id="show-all"> show all</label>
    <div class="boss" style="left:50.22%;top:88.00%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174054">Falric</a><i>50.22, 88.00</i></div>
    <div class="boss" style="left:79.86%;top:60.93%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174053">Prophète Tharon'ja</a><i>79.86, 60.93</i></div>
    <div class="boss" style="left:77.89%;top:65.92%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174052">Novos l'Invocateur</a><i>77.89, 65.92</i></div>
    <div class="boss" style="left:58.53%;top:39.46%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174051">Trollétripe</a><i>58.53, 39.46</i></div>
    <div class="boss" style="left:67.48%;top:58.09%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174050">Krik'thir le Gardien de la porte</a><i>67.48, 58.09</i></div>
    <div class="boss" style="left:29.57%;top:62.26%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174049">Prince Taldaram</a><i>29.57, 62.26</i></div>
    <div class="boss" style="left:36.57%;top:67.63%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174066">Le Recousu</a><i>36.57, 67.63</i></div>
    <div class="boss" style="left:49.58%;top:32.24%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174065">Reine de sang Lana'thel</a><i>49.58, 32.24</i></div>
    <div class="boss" style="left:57.30%;top:30.36%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174064">Professeur Putricide</a><i>57.30, 30.36</i></div>
    <div class="boss" style="left:57.65%;top:55.97%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174062">Skadi le Brutal</a><i>57.67, 55.97</i></div>
    <div class="boss" style="left:52.32%;top:52.53%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174061">Ingvar le Pilleur</a><i>52.32, 52.53</i></div>
    <div class="boss" style="left:44.35%;top:49.13%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174048">Ancien Nadox</a><i>44.35, 19.13</i></div>
    <div class="boss" style="left:53.93%;top:44.62%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174060">Prince Keleseth</a><i>53.93, 44.62</i></div>
    <div class="boss" style="left:64.80%;top:22.09%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174059">Le Chevalier noir</a><i>64.80, 22.09</i></div>
    <div class="boss" style="left:70.54%;top:38.56%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174058">Bronjahm</a><i>70.54, 38.56</i></div>
    <div class="boss" style="left:46.88%;top:65.39%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174057">Seigneur du Fléau Tyrannus</a><i>46.88, 65.39</i></div>
    <div class="boss" style="left:59.09%;top:72.33%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174056">Maître-forge Gargivre</a><i>59.09, 72.33</i></div>
    <div class="boss" style="left:58.18%;top:83.52%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174055">Marwyn</a><i>58.18, 83.52</i></div>
    <div class="boss" style="left:51.16%;top:74.48%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174063">Dame Murmemort</a><i>51.16, 74.48</i></div>
    <div class="boss" style="left:31.60%;top:70.50%"><time>0</time><a target="_blank" href="https://www.wowhead.com/npc=174067">Noth le Porte-peste</a><i>31.6, 70.5</i></div>
  </div>
</body>
<script>
const whTooltips = {colorLinks: true, iconizeLinks: true, renameLinks: true}
const locales = ['fr','de','ko','pt','ru','es','cn']
let [locale] = navigator.language.split('-')
locales.includes(locale) || (locale = 'www')
const loots = [["https://www.wowhead.com/npc=174054",[[183664,"Bracer of Ground Molars"],[183665,"Valonforth's Marred Pauldrons"],[183667,"Geistslicer"]]],["https://www.wowhead.com/npc=174053",[[183684,"Tharon'ja's Protectorate"],[183685,"Phantasmic Seal of the Prophet"],[183686,"Breeches of the Skeletal Serpent"]]],["https://www.wowhead.com/npc=174052",[[183627,"Summoner's Granite Gavel"],[183671,"Necromantic Wristwraps"],[183672,"Cuirass of Undeath"]]],["https://www.wowhead.com/npc=174051",[[183626,"Troll Gorer"],[183640,"Leggings of Disreputable Charms"],[183669,"Cowl of the Rampaging Troll"]]],["https://www.wowhead.com/npc=174050",[[183681,"Webrending Machete"],[183682,"Cinch of the Servant"],[183683,"Skittering Vestments"]]],["https://www.wowhead.com/npc=174049",[[183625,"Reforged Necklace of Taldaram"],[183677,"Blood-Drinker's Belt"],[183679,"Taldaram's Supple Slippers"]]],["https://www.wowhead.com/npc=174066",[[183643,"Severance of Mortality"],[183644,"Regurgitator's Shoulderpads"],[183645,"Cinch of the Tortured"]]],["https://www.wowhead.com/npc=174065",[[183646,"Chestguard of Siphoned Vitality"],[183647,"Bloodspatter"],[183648,"Veincrusher Gauntlets"]]],["https://www.wowhead.com/npc=174064",[[183649,"Bag of Discarded Entrails"],[183650,"Miniscule Abomination in a Jar"],[183651,"Chestplate of Septic Sutures"]]],["https://www.wowhead.com/npc=174062",[[44151,"Reins of the Blue Proto-Drake"],[183656,"Drake Rider's Jerkin"],[183657,"Skadi's Scaled Sollerets"],[183670,"Skadi's Saronite Belt"]]],["https://www.wowhead.com/npc=174061",[[183658,"Ingvar's Monolithic Skullcleaver"],[183659,"Annhylde's Band"],[183668,"Razor-Barbed Leather Belt"]]],["https://www.wowhead.com/npc=174048",[[183624,"Serrated Blade of Nadox"],[183641,"Shoulderpads of Corpal Rigidity"],[183673,"Nerubian Aegis Ring"]]],["https://www.wowhead.com/npc=174060",[[183661,"Drake Stabler's Gauntlets"],[183678,"Keleseth's Influencer"],[183680,"Royal Sanguine Cloak"]]],["https://www.wowhead.com/npc=174059",[[183636,"Helm of the Violent Fracas"],[183637,"Shoulderpads of the Notorious Knave"],[183638,"Phantasmic Kris"]]],["https://www.wowhead.com/npc=174058",[[183634,"Papa's Mint Condition Bag"],[183635,"Grieving Gauntlets"],[183639,"Gaze of Bewilderment"],[183675,"Cold Sweat Mitts"]]],["https://www.wowhead.com/npc=174057",[[183632,"Protector of Stolen Souls"],[183633,"Fringed Wyrmleather Leggings"],[183674,"Rimewoven Pantaloons"]]],["https://www.wowhead.com/npc=174056",[[183630,"Garfrost's Two-Ton Bludgeon"],[183631,"Ring of Carnelian and Sinew"],[183666,"Legguards of the Frosty Fathoms"]]],["https://www.wowhead.com/npc=174055",[[183662,"Frostsworn Rattleshirt"],[183663,"Sightless Capuchin of Ulmaas"],[183687,"Frayed Flesh-Stitched Shoulderguards"]]],["https://www.wowhead.com/npc=174063",[[183652,"Zod's Echoing Longbow"],[183653,"Deathwhisper Vestment"],[183655,"Handgrips of Rime and Sleet"]]],["https://www.wowhead.com/npc=174067",[[183642,"Robes of Rasped Breaths"],[183654,"Etched Dragonbone Stompers"],[183676,"Hailstone Loop"]]]]
const bossIcon = document.getElementById('fav').href
const bosses = [...document.getElementsByClassName('boss')]
bosses.forEach(b => b.style.backgroundImage = `url(${bossIcon})`)

const rawTimings = `
  <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Reine de sang Lana'thel</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">06h00</td>
      <td style="text-align : center;">12h40</td>
      <td style="text-align : center;">19h20</td>
      <td style="text-align : center;">-</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Professeur Putricide</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">06h20</td>
      <td style="text-align : center;">13h00</td>
      <td style="text-align : center;">19h40</td>
      <td style="text-align : center;">-</td>
    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Dame Murmemort</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">00h00</td>
      <td style="text-align : center;">06h40</td>
      <td style="text-align : center;">13h20</td>
      <td style="text-align : center;">20h00</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Skadi le Brutal</i> <a class="tooltip_inline monture_lien violet"href="https://www.mamytwink.com/montures/renes-de-proto-drake-bleu" data-type="monture" data-couleur="violet" data-type-monture="Volante" data-source-monture="Butin" data-difficulte-monture="Difficile"><img src="https://www.mamytwink.com/articles/montures/proto-bleu-icone.jpg" alt="Icone monture Rênes de proto-drake bleu"/><span class="nom">Rênes de proto-drake bleu</span></a> </td>
    </tr>
    <tr>
      <td style="text-align : center;">00h20</td>
      <td style="text-align : center;">07h00</td>
      <td style="text-align : center;">13h40</td>
      <td style="text-align : center;">20h20</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Ingvar le Pilleur</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">00h40</td>
      <td style="text-align : center;">07h20</td>
      <td style="text-align : center;">14h00</td>
      <td style="text-align : center;">20h40</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Prince Keleseth</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">01h00</td>
      <td style="text-align : center;">07h40</td>
      <td style="text-align : center;">14h20</td>
      <td style="text-align : center;">21h00</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Le Chevalier noir</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">01h20</td>
      <td style="text-align : center;">08h00</td>
      <td style="text-align : center;">14h40</td>
      <td style="text-align : center;">21h20</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Bronjahm </i>(sac 34 emplacements)</td>
    </tr>
    <tr>
      <td style="text-align : center;">01h40</td>
      <td style="text-align : center;">08h20</td>
      <td style="text-align : center;">15h00</td>
      <td style="text-align : center;">21h40</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Seigneur du Fléau Tyrannus</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">02h00</td>
      <td style="text-align : center;">08h40</td>
      <td style="text-align : center;">15h20</td>
      <td style="text-align : center;">22h00</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Maître-forge Gargivre</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">02h20</td>
      <td style="text-align : center;">09h00</td>
      <td style="text-align : center;">15h40</td>
      <td style="text-align : center;">22h20</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Marwyn</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">02h40</td>
      <td style="text-align : center;">09h20</td>
      <td style="text-align : center;">16h00</td>
      <td style="text-align : center;">22h40</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Falric</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">03h00</td>
      <td style="text-align : center;">09h40</td>
      <td style="text-align : center;">16h20</td>
      <td style="text-align : center;">23h00</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Prophète Tharon'ja</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">03h20</td>
      <td style="text-align : center;">10h00</td>
      <td style="text-align : center;">16h40</td>
      <td style="text-align : center;">23h20</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Novos l'Invocateur</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">03h40</td>
      <td style="text-align : center;">10h20</td>
      <td style="text-align : center;">17h00</td>
      <td style="text-align : center;">23h40</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Trollétripe</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">04h00</td>
      <td style="text-align : center;">10h40</td>
      <td style="text-align : center;">17h20</td>
      <td style="text-align : center;">00h00*</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Krik'thir le Gardien de la porte</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">04h20</td>
      <td style="text-align : center;">11h00</td>
      <td style="text-align : center;">17h40</td>
      <td style="text-align : center;">00h20*</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Prince Taldaram</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">04h40</td>
      <td style="text-align : center;">11h20</td>
      <td style="text-align : center;">18h00</td>
      <td style="text-align : center;">00h40*</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Ancien Nadox</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">05h00</td>
      <td style="text-align : center;">11h40</td>
      <td style="text-align : center;">18h20</td>
      <td style="text-align : center;">01h00*</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Noth le Porte-peste</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">05h20</td>
      <td style="text-align : center;">12h00</td>
      <td style="text-align : center;">18h40</td>
      <td style="text-align : center;">01h20*</td>

    </tr>
    <tr>
      <td style="text-align : center; color : rgb(204, 188, 70);" colspan="4" style="text-align : center;"><i>Le Recousu</i></td>
    </tr>
    <tr>
      <td style="text-align : center;">05h40</td>
      <td style="text-align : center;">12h20</td>
      <td style="text-align : center;">19h00</td>
      <td style="text-align : center;">01h40*</td>

    </tr>

`

const rtf = new Intl.RelativeTimeFormat(navigator.language, {
  localeMatcher: "best fit",
  numeric: "always",
  style: "long",
})

const S = 1000
const M = 60*1000
const H = 60*M
const offset = new Date().getTimezoneOffset() * M
const start = time => new Date().setHours(0,0,0,0) + offset + time
const relatime = time => {
  const diff = start(time) - Date.now()
  if (diff > H) {
    const pre = diff > 0 ? 'in ' : ''
    const post = diff < 0 ? ' ago' : ''
    const d = Math.abs(diff)
    const hours = Math.floor(d/H)
    const minutes = Math.floor((d % H) / M)
    return `${pre}${hours}h${String(minutes).padStart(2, '0')}${post}`
  }
  return Math.abs(diff) < M
    ? rtf.format(Math.round(diff/1000), 'second')
    : rtf.format(Math.round(diff/M), 'minute')
}

const timings = []
const now = Date.now()
const selection = (new URLSearchParams(location.search).get('boss') || '').split(',').filter(Boolean).map(Number)
for (const line of rawTimings.split('\n')) {
  if (/>(\d\d)h(\d\d)</.test(line)) {
    const [, h, m] = line.match(/>(\d\d)h(\d\d)</).map(Number)
    const time = (h*60+m)*M + 3*M + 25*S
    boss && timings.push({ boss, time, text: relatime(time) })
  } else if (/i>([^<]+)</.test(line)) {
    const name = line.match(/i>([^<]+)</)[1].trim()
    boss = bosses.find(b => b.firstChild.nextSibling.textContent === name)
    if (!boss) {
      console.log({ name, line })
      continue
    }
    const { href } = boss.firstChild.nextSibling
    boss.firstChild.nextSibling.href = boss.firstChild.nextSibling.href.replace('https://www', `https://${locale}`)
    if (!selection.length) continue
    selection.includes(Number(href.split('=')[1])) || (boss = undefined)
  }
}

console.log(timings)
const checkbox = document.getElementById('show-all')

timings.sort((a, b) => b.time - a.time)
const setTime = t => t && (t.boss.firstChild.textContent = relatime(t.time))
const update = () => {
  timings.forEach(b => b.boss.className = 'boss')
  if (checkbox.checked) {
    timings
      .filter(t => start(t.time) > Date.now())
      .forEach(b => setTime(b) && (b.boss.className = 'boss current'))
  } else {
    const index = timings.findIndex(t => start(t.time) < Date.now())
    const current = timings[index-1]
    const next = timings[index]
    const old = timings[index+2]
    setTime(current) && (current.boss.classList.add('current'))
    setTime(next) && (next.boss.classList.add('next'))
  }
}

setInterval(update, 1000)
update()

loots.forEach(([url, items]) => {
  const match = timings.find(t => t.boss.firstChild.nextSibling.href === url)
  if (!match) return
  const lootsElement = document.createElement('div')
  for (const [id, name] of items) {
    const a = document.createElement('a')
    a.href = `https://${locale}.wowhead.com/item=${id}`
    a.textContent = name
    lootsElement.appendChild(a)
  }

  lootsElement.className = 'loot'
  match.boss.appendChild(lootsElement)
})

selection.length
  ? Object.assign(checkbox, { checked: true, disabled: true })
  : checkbox.addEventListener('change', update)

const notify = document.getElementById('notify')
notify.checked = Notification.permission === "granted"
notify.addEventListener('change', async () => {
  if (!notify.checked) return
  const permission = await Notification.requestPermission()
  notify.checked = permission === 'granted' && Notification.permission === "granted"
})

const sound = document.getElementById('sound')
// play notes
const play = (() => {
  let _muted = true, _silentSound
  // todo: handle alias = {DF:'CS',EF:'DS',GF:'FS',AF:'GS',BF:'AS'}
  const signs = 'A.AS.B.C.CS.D.DS.E.F.FS.G.GS'.split('.')
  const tempo = 100
  const durations = {B:128,W:64,H:32,Q:16,E:8,S:4,BD:192,WD:96,HD:48,QD:24,ED:12,SD:6}

  // note: exponentialRampToValueAtTime seems borken on FF, so we define our own curve
  const expWave = new Float32Array([...Array(9).keys()].map(n => (Math.exp(n) - 1) / Math.exp(8)).reverse())
  const context = window.AudioContext && new AudioContext()
  const types = ['sine', 'square', 'sawtooth', 'triangle']
  const notes = Object.fromEntries(signs.slice(0,8)
    .flatMap((_,o)=>signs.map((s,n)=>[s+(o+1),55*2**((12*o + n)/12)])))
  const sound = (frequency, type = 'sine', start = 0) => {
    const o = context.createOscillator()
    const g = context.createGain()
    o.type = type
    o.frequency.value = frequency
    o.connect(g)
    g.connect(context.destination)
    o.start(start)
    return g
  }

  const p = !context ? () => {} : (melody, muted = _muted) => {
    if ((_muted = muted)) return 0
    let delay = context.currentTime
    for (const noteStr of melody.split('+')) {
      const [ note, rest = '' ] = noteStr.split('.')
      const duration = durations[rest.slice(0, -1)] / tempo
      const g = sound(notes[note], types[rest[rest.length - 1]], delay)
      g.gain.setValueCurveAtTime(expWave, delay, duration)
      delay += duration
    }
    return Math.floor((delay - context.currentTime) * 1000)
  }

  p.sound = !context ? () => {} : sound
  p.muted = muted => _muted = Boolean(muted)
  p.isMuted = () => _muted
  p.context = context
  return p
})()

sound.checked = !play.isMuted()
sound.addEventListener('change', () => {
  console.log(play.isMuted())
  if (play.isMuted()) {
    play.muted(false)
    play('CS6.ED+A7.BD')
  } else {
    play('A7.ED+CS6.BD')
    play.muted(true)
  }
})

const notifyEngine = () => {
  const { boss, time } = [...timings].reverse().find(t => start(t.time) > Date.now())
  setTimeout(() => {
    play('CS6.ED+A7.BD')
    if (!notify.checked) return
    const notification = new Notification(`${boss.firstChild.nextSibling.textContent} just spawned`)
    console.log(notification)
    notifyEngine()
  }, start(time) - Date.now())
  console.log('next boss', boss.firstChild.nextSibling.textContent, 'in', start(time) - Date.now(), 'ms')
}
notifyEngine()

</script>
<script async src="https://wow.zamimg.com/widgets/power.js"></script>
</html>
